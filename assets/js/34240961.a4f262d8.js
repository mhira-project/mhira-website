"use strict";(self.webpackChunkmhira_website=self.webpackChunkmhira_website||[]).push([[7618],{1715:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>a,default:()=>c,frontMatter:()=>r,metadata:()=>l,toc:()=>o});var i=n(4848),s=n(8453);const r={sidebar_position:8},a="Patient-report shiny app",l={id:"mhira-reporting-guide/patient-report-shiny-app",title:"Patient-report shiny app",description:"Please consult 'using shiny apps for reporting' for more background information.",source:"@site/docs/5-mhira-reporting-guide/8-patient-report-shiny-app.md",sourceDirName:"5-mhira-reporting-guide",slug:"/mhira-reporting-guide/patient-report-shiny-app",permalink:"/docs/mhira-reporting-guide/patient-report-shiny-app",draft:!1,unlisted:!1,editUrl:"https://github.com/mhira-project/documentation/edit/main/docs/5-mhira-reporting-guide/8-patient-report-shiny-app.md",tags:[],version:"current",sidebarPosition:8,frontMatter:{sidebar_position:8},sidebar:"tutorialSidebar",previous:{title:"Integrating Shiny Apps for Reporting with MHIRA",permalink:"/docs/mhira-reporting-guide/using-shiny-apps-for-reporting"},next:{title:"Implementation scenarios",permalink:"/docs/category/implementation-scenarios"}},d={},o=[{value:"What is the patient report?",id:"what-is-the-patient-report",level:2},{value:"How to make the patient report work with MHIRA",id:"how-to-make-the-patient-report-work-with-mhira",level:2},{value:"Installing the app to work with MHIRA:",id:"installing-the-app-to-work-with-mhira",level:3},{value:"Updating the app",id:"updating-the-app",level:3},{value:"Adding algorithms for sales and cutoffs for the questionnairs",id:"adding-algorithms-for-sales-and-cutoffs-for-the-questionnairs",level:3},{value:"scales_table",id:"scales_table",level:4},{value:"cutoffs",id:"cutoffs",level:4},{value:"scales_function",id:"scales_function",level:4},{value:"Creating the button",id:"creating-the-button",level:3}];function h(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h1,{id:"patient-report-shiny-app",children:"Patient-report shiny app"}),"\n",(0,i.jsx)(t.admonition,{type:"tip",children:(0,i.jsxs)(t.p,{children:["Please consult ",(0,i.jsx)(t.a,{href:"./using-shiny-apps-for-reporting",children:"'using shiny apps for reporting'"})," for more background information."]})}),"\n",(0,i.jsx)(t.p,{children:"The patient-report shiny app serves as a patient data reporting tool for the Mental Health Information Reporting Assisitant (MHIRA)."}),"\n",(0,i.jsx)(t.admonition,{type:"note",children:(0,i.jsxs)(t.p,{children:["This documenation refers to ",(0,i.jsx)(t.a,{href:"https://github.com/mhira-project/patient-report",children:"this repository"})]})}),"\n",(0,i.jsx)(t.h2,{id:"what-is-the-patient-report",children:"What is the patient report?"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.a,{href:"../user-manual/reports#example-of-a-report",children:"Click here for an example"})}),"\n",(0,i.jsx)(t.h2,{id:"how-to-make-the-patient-report-work-with-mhira",children:"How to make the patient report work with MHIRA"}),"\n",(0,i.jsx)(t.h3,{id:"installing-the-app-to-work-with-mhira",children:"Installing the app to work with MHIRA:"}),"\n",(0,i.jsxs)(t.p,{children:["You can clone the app to the ",(0,i.jsx)(t.a,{href:"./using-shiny-apps-for-reporting",children:"folder inside the shiny server"})," using"]}),"\n",(0,i.jsxs)(t.p,{children:["git clone ",(0,i.jsx)(t.a,{href:"https://github.com/mhira-project/patient-report.git",children:"https://github.com/mhira-project/patient-report.git"})]}),"\n",(0,i.jsx)(t.h3,{id:"updating-the-app",children:"Updating the app"}),"\n",(0,i.jsx)(t.p,{children:"For updating the shiny app, navigate inside the folder containing the app and use"}),"\n",(0,i.jsx)(t.p,{children:"git pull"}),"\n",(0,i.jsx)(t.h3,{id:"adding-algorithms-for-sales-and-cutoffs-for-the-questionnairs",children:"Adding algorithms for sales and cutoffs for the questionnairs"}),"\n",(0,i.jsx)(t.p,{children:"For the patient-report to work you will need to provide information on how to calculate scales and on the cutoffs for these scales."}),"\n",(0,i.jsxs)(t.p,{children:["For example the questionnaire ",(0,i.jsx)(t.a,{href:"https://www.apa.org/depression-guideline/patient-health-questionnaire.pdf",children:"PHQ-9"}),' which evaluates depressive symtoms presents with a "Total Score" which is the sum of the scores for its 9 items. PHQ-9 also has ',(0,i.jsx)(t.a,{href:"https://bmcpsychiatry.biomedcentral.com/articles/10.1186/s12888-019-2262-9#:~:text=Regarding%20severity%2C%20PHQ%2D9%20comprises,severe%20depressive%20symptoms%20%5B25%5D.",children:"cutoff points"}),": It comprises five categories, where a cut-off point of 0\u20134 indicates no depressive symptoms, 5\u20139 mild depressive symptoms, 10\u201314 moderate depressive symptoms, 15\u201319 moderately-severe depressive symptoms, and 20\u201327 severe depressive symptoms."]}),"\n",(0,i.jsxs)(t.p,{children:["We need to provide this information to the patient-report:\nTo this aim, files containing this information can be ",(0,i.jsx)(t.a,{href:"../guide-for-admins/questionnaires",children:"uploaded together whith the questionniares"})," under the 'script tab' in the 'questionnaires' menu (accessible from the navigation bar)."]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"script",src:n(8586).A+"",title:"scripts",width:"2135",height:"1354"})}),"\n",(0,i.jsx)(t.admonition,{type:"note",children:(0,i.jsx)(t.p,{children:"Any text based file can be uploaded ('.txt', '.csv', '.R', '.py'). Please make sure the files are encoded in 'UTF-8'.\nThe encoding can be selected in the 'save as' menu in excel and many text editors.\nThe extension (e.g. '.txt') of the file does not matter."})}),"\n",(0,i.jsx)(t.h4,{id:"scales_table",children:"scales_table"}),"\n",(0,i.jsx)(t.p,{children:"The patient report shiny app needs a formula to calculte the scales of the questionnaire.\nThese can be uploaded in form of a '.csv' table."}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"ScaleName"}),(0,i.jsx)(t.th,{children:"Formula"}),(0,i.jsx)(t.th,{children:"scaleMin"}),(0,i.jsx)(t.th,{children:"scaleMax"}),(0,i.jsx)(t.th,{children:"mean"}),(0,i.jsx)(t.th,{children:"sd"}),(0,i.jsx)(t.th,{children:"plotGroup"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"TotalScore"}),(0,i.jsx)(t.td,{children:"q1 + q2 + q3 + q4 + q5 + q6 + q7 + q8 + q9"}),(0,i.jsx)(t.td,{children:"0"}),(0,i.jsx)(t.td,{children:"28"}),(0,i.jsx)(t.td,{}),(0,i.jsx)(t.td,{}),(0,i.jsx)(t.td,{children:"1"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Suicidality"}),(0,i.jsx)(t.td,{children:"q9"}),(0,i.jsx)(t.td,{children:"0"}),(0,i.jsx)(t.td,{children:"3"}),(0,i.jsx)(t.td,{}),(0,i.jsx)(t.td,{}),(0,i.jsx)(t.td,{})]})]})]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"ScaleName: The name of the scale."}),"\n",(0,i.jsxs)(t.li,{children:["Formula: R code to calculate the scale. The names of the objects (q1,q2,...) come from the names selected in the ",(0,i.jsx)(t.a,{href:"../guide-for-admins/questionnaires#creating-an-xlsform",children:"xlsform you used to create the questionnaire"}),"."]}),"\n",(0,i.jsx)(t.li,{children:"scaleMin: Sets the lower limit in the plot."}),"\n",(0,i.jsx)(t.li,{children:"scalesMax: Sets the upper limit in the plot."}),"\n",(0,i.jsx)(t.li,{children:"mean: mean of healthy population, currently not used."}),"\n",(0,i.jsx)(t.li,{children:"sd: standard deviation of normal population, currently not used."}),"\n",(0,i.jsx)(t.li,{children:"plotGroup: Should the scale be printed in the plot. Empty values or zeros are not printed. Providing different values >= 0 will result in a plot with multiple facets which have their own sale range.  Multiple scales with the same value >= 0 will result in these scales printed in the same facet."}),"\n"]}),"\n",(0,i.jsx)(t.admonition,{type:"note",children:(0,i.jsx)(t.p,{children:"When uploading these files, the file name does not matter. However the name of the scripts input in the MHIRA form needs to be 'scales_table'."})}),"\n",(0,i.jsx)(t.h4,{id:"cutoffs",children:"cutoffs"}),"\n",(0,i.jsx)(t.p,{children:"CSV files containing cutoffs can be uploaded in the following format."}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"scale"}),(0,i.jsx)(t.th,{children:"low_cut"}),(0,i.jsx)(t.th,{children:"high_cut"}),(0,i.jsx)(t.th,{children:"level"}),(0,i.jsx)(t.th,{children:"warning"}),(0,i.jsx)(t.th,{children:"text_order"}),(0,i.jsx)(t.th,{children:"interpretation"}),(0,i.jsx)(t.th,{children:"recommendation"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"TotalScore"}),(0,i.jsx)(t.td,{children:"0"}),(0,i.jsx)(t.td,{children:"5"}),(0,i.jsx)(t.td,{children:"none"}),(0,i.jsx)(t.td,{children:"FALSE"}),(0,i.jsx)(t.td,{children:"1"}),(0,i.jsx)(t.td,{children:"The level of depression was none."}),(0,i.jsx)(t.td,{})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"TotalScore"}),(0,i.jsx)(t.td,{children:"5"}),(0,i.jsx)(t.td,{children:"10"}),(0,i.jsx)(t.td,{children:"mild"}),(0,i.jsx)(t.td,{children:"FALSE"}),(0,i.jsx)(t.td,{children:"1"}),(0,i.jsx)(t.td,{children:"The level of depression was mild."}),(0,i.jsx)(t.td,{children:"Please consider further clincal interviews to find out if help regarding depression is required."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"TotalScore"}),(0,i.jsx)(t.td,{children:"10"}),(0,i.jsx)(t.td,{children:"15"}),(0,i.jsx)(t.td,{children:"moderate"}),(0,i.jsx)(t.td,{children:"FALSE"}),(0,i.jsx)(t.td,{children:"1"}),(0,i.jsx)(t.td,{children:"The level of depression was moderate."}),(0,i.jsx)(t.td,{children:"Please consider further clincal interviews to find out if help regarding depression is required."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"TotalScore"}),(0,i.jsx)(t.td,{children:"15"}),(0,i.jsx)(t.td,{children:"20"}),(0,i.jsx)(t.td,{children:"moderately severe"}),(0,i.jsx)(t.td,{children:"FALSE"}),(0,i.jsx)(t.td,{children:"1"}),(0,i.jsx)(t.td,{children:"The level of depression was moderately severe."}),(0,i.jsx)(t.td,{})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"TotalScore"}),(0,i.jsx)(t.td,{children:"20"}),(0,i.jsx)(t.td,{children:"28"}),(0,i.jsx)(t.td,{children:"severe"}),(0,i.jsx)(t.td,{children:"FALSE"}),(0,i.jsx)(t.td,{children:"1"}),(0,i.jsx)(t.td,{children:"The level of depression was severe."}),(0,i.jsx)(t.td,{children:"Discuss the case with a psychiatrist at your department. Medication might be helpful."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Suicidality"}),(0,i.jsx)(t.td,{children:"0"}),(0,i.jsx)(t.td,{children:"1"}),(0,i.jsx)(t.td,{children:"not at all"}),(0,i.jsx)(t.td,{children:"FALSE"}),(0,i.jsx)(t.td,{children:"2"}),(0,i.jsx)(t.td,{children:"The patient was not at all suicidal."}),(0,i.jsx)(t.td,{})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Suicidality"}),(0,i.jsx)(t.td,{children:"1"}),(0,i.jsx)(t.td,{children:"2"}),(0,i.jsx)(t.td,{children:"several days"}),(0,i.jsx)(t.td,{children:"TRUE"}),(0,i.jsx)(t.td,{children:"2"}),(0,i.jsx)(t.td,{children:"The patient suicidal on several days."}),(0,i.jsx)(t.td,{children:"Make sure the patient does't harm himself."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Suicidality"}),(0,i.jsx)(t.td,{children:"2"}),(0,i.jsx)(t.td,{children:"3"}),(0,i.jsx)(t.td,{children:"more than half the days"}),(0,i.jsx)(t.td,{children:"TRUE"}),(0,i.jsx)(t.td,{children:"2"}),(0,i.jsx)(t.td,{children:"The patient was suicidal on more than half of the days."}),(0,i.jsx)(t.td,{children:"Make sure the patient does't harm himself."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Suicidality"}),(0,i.jsx)(t.td,{children:"3"}),(0,i.jsx)(t.td,{children:"4"}),(0,i.jsx)(t.td,{children:"nearly every day"}),(0,i.jsx)(t.td,{children:"TRUE"}),(0,i.jsx)(t.td,{children:"2"}),(0,i.jsx)(t.td,{children:"The patient  suicidal nearly every day."}),(0,i.jsx)(t.td,{children:"Please consider hospitalisation to keep the patient safe."})]})]})]}),"\n",(0,i.jsx)(t.h1,{id:"columns",children:"Columns"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"scale: Needs to correspond to the scaleName in scales_table. This is a common source of errors"}),"\n",(0,i.jsx)(t.li,{children:"low_cut: Included lower cutoff for a certain level. The upper bound is not inculded."}),"\n",(0,i.jsx)(t.li,{children:"high_cut: Included higher cutoff for the level. The upper bound is not included  except for the highest level."}),"\n",(0,i.jsx)(t.li,{children:"level: severity level of these cutoffs. Will be used in the plot legend."}),"\n",(0,i.jsx)(t.li,{children:"text_order: The order in which the scales are represented. Will allow to concatenate the interpretations and recommendations."}),"\n",(0,i.jsx)(t.li,{children:"Interpretation: Text bocks associated to a certain level."}),"\n",(0,i.jsx)(t.li,{children:"Recommendatin: Text bocks associated to a certain level."}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"The cutoff script needs to be named 'cutoffs' in the MHIRA form."}),"\n",(0,i.jsx)(t.h4,{id:"scales_function",children:"scales_function"}),"\n",(0,i.jsx)(t.p,{children:"Sometimes calculating the scales is more complex. In these cases, a table might be too limited.\nYou can also upload R functions which need to be named 'scale_function' as in the following example."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-r",children:'# Input: The parameter given to the function is a dataframe \'dfItems\' with the columns\n# representing the item data of a single questionnaire e.g., item1; item2; item3, ...\n# The column names should be the item names i.e., name in the xlsform.\n# The data frame has a single row as it only represents data of one questionnaire.\n\n# Thus, the input could look like this:\n\n# item1 item2 item3 item4 item5\n#   4     6     2     0      1\n\n\n# Output:The function should return a data frame structured like the example below:\n\n#      scale        value   scaleMin scaleMax mean sd plotGroup\n# 1 somatic_symptoms   5        0       12     NA  NA      1\n# 2 sleep              2        0       10     NA  NA      1\n# 3 suicidality        1        0        1     NA  NA      1\n\n# The data frame has a long format if there are multiple scales\n\n\nscales_function = function(dfItmes){\n  \n  anyNotFalse = function(x){any(x) | any(is.na(x))}\n  \n  df = dfItems %>% \n    mutate(\n      item4 = as.logical(item24),\n      item5 = as.logical(item25)\n    )\n  \n  \n  df = df %>%\n    summarise(\n      somatic_symptoms\t= mean(item1, item2, na.rm = T),\n      sleep = \titem3,\n      suicidality\t= c(item4, item5) %>% anyNotFalse() %>% as.numeric()  \n      ) %>% \n    pivot_longer(cols = everything(),values_to = "value", names_to = "scale")\n  \n  dfS =  data.frame(df, scaleMin = 0, scaleMax = c(4,4,4,4,4,4,4,4,4,4,1,1), mean = NA, sd = NA, plotGroup = c(2,2,1,2,2,2,2,2,1,2,3,3))  \n  \n  \n  # Run minimum plausibility check\n  \n  if(!all(c("scale" ,"value") %in%  colnames(dfS))){print("scale and value columns are required as output of scales_function")}\n  \n  # Return results\n  \n  return(dfS)\n  \n}\n\n'})}),"\n",(0,i.jsxs)(t.p,{children:["Make sure that the ",(0,i.jsx)(t.a,{href:"using-shiny-apps-for-reporting#adding-r-packages-to-the-shiny-server",children:"shiny server has the required packages"}),".\nPlease assign the name 'scales_function' as name for the script when uploading it."]}),"\n",(0,i.jsx)(t.h3,{id:"creating-the-button",children:"Creating the button"}),"\n",(0,i.jsxs)(t.p,{children:["Please refer to ",(0,i.jsx)(t.a,{href:"../guide-for-admins/reports#create-buttons",children:"this section"})," of how to create the button for the patient reports."]})]})}function c(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},8586:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/scripts-0b8cbbeca10103a93f787cf7a1cf0cdd.png"},8453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>l});var i=n(6540);const s={},r=i.createContext(s);function a(e){const t=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(r.Provider,{value:t},e.children)}}}]);