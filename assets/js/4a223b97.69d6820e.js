"use strict";(self.webpackChunkmhira_website=self.webpackChunkmhira_website||[]).push([[745],{1325:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>a,toc:()=>l});var t=i(4848),s=i(8453);const o={sidebar_position:2},r="Installing MHIRA",a={id:"installation-guide/installing-mhira",title:"Installing MHIRA",description:"MHIRA can be installed from docker containers using docker-compose.",source:"@site/docs/4-installation-guide/2-installing-mhira.md",sourceDirName:"4-installation-guide",slug:"/installation-guide/installing-mhira",permalink:"/docs/installation-guide/installing-mhira",draft:!1,unlisted:!1,editUrl:"https://github.com/mhira-project/documentation/edit/main/docs/4-installation-guide/2-installing-mhira.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Requirements",permalink:"/docs/installation-guide/requirements"},next:{title:"Data and Backup",permalink:"/docs/installation-guide/data-and-backup"}},c={},l=[{value:"Pre-requisites",id:"pre-requisites",level:2},{value:"Docker",id:"docker",level:3},{value:"Docker-compose",id:"docker-compose",level:3},{value:"Installation of MHIRA",id:"installation-of-mhira",level:2},{value:"Cloning the docker setup from github",id:"cloning-the-docker-setup-from-github",level:3},{value:"Creating the environment (.env) file",id:"creating-the-environment-env-file",level:3},{value:"Setting the JWT Secret in the .env file",id:"setting-the-jwt-secret-in-the-env-file",level:3},{value:"Data Storage Location",id:"data-storage-location",level:3},{value:"Settings passwords for the databases",id:"settings-passwords-for-the-databases",level:3},{value:"Setting access of MHIRA and HTTPS Certificates in the .env file",id:"setting-access-of-mhira-and-https-certificates-in-the-env-file",level:3},{value:"Initialising MHIRA",id:"initialising-mhira",level:3},{value:"Updating your installation",id:"updating-your-installation",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"installing-mhira",children:"Installing MHIRA"}),"\n",(0,t.jsxs)(n.p,{children:["MHIRA can be installed from docker containers using docker-compose.\nThe following page will walk you through the installation process.\n",(0,t.jsx)(n.a,{href:"https://github.com/mhira-project/mhira-docker",children:"Here"})," you fill find the github repository containing the docker-compose setup."]}),"\n",(0,t.jsx)(n.h2,{id:"pre-requisites",children:"Pre-requisites"}),"\n",(0,t.jsx)(n.p,{children:"You will need to install docker and docker-compose:"}),"\n",(0,t.jsx)(n.h3,{id:"docker",children:"Docker"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Docker installation instruction can be found ",(0,t.jsx)(n.a,{href:"https://docs.docker.com/engine/install/",children:"here"})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Consider executing the ",(0,t.jsx)(n.a,{href:"https://docs.docker.com/engine/install/linux-postinstall/",children:"post-installation steps"})," e.g., adding your user to a docker group and setting docker to re-start automatically."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"docker-compose",children:"Docker-compose"}),"\n",(0,t.jsx)(n.p,{children:"You can check whether you already have docker compose with:"}),"\n",(0,t.jsx)(n.p,{children:"docker compose version"}),"\n",(0,t.jsxs)(n.p,{children:["In case docker compose is not installed, ",(0,t.jsx)(n.a,{href:"https://docs.docker.com/compose/install/",children:"installation instructions can be found here"})]}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsx)(n.p,{children:"To avoid issues, check whether your docker and docker-compose versions are up to date."})}),"\n",(0,t.jsx)(n.h2,{id:"installation-of-mhira",children:"Installation of MHIRA"}),"\n",(0,t.jsx)(n.h3,{id:"cloning-the-docker-setup-from-github",children:"Cloning the docker setup from github"}),"\n",(0,t.jsxs)(n.p,{children:["Clone ",(0,t.jsx)(n.a,{href:"https://github.com/mhira-project/mhira-docker",children:"this"})," repository to your machine"]}),"\n",(0,t.jsxs)(n.p,{children:["git clone ",(0,t.jsx)(n.a,{href:"https://github.com/mhira-project/mhira-docker.git",children:"https://github.com/mhira-project/mhira-docker.git"})]}),"\n",(0,t.jsx)(n.h3,{id:"creating-the-environment-env-file",children:"Creating the environment (.env) file"}),"\n",(0,t.jsxs)(n.p,{children:["Navigate into the ",(0,t.jsx)(n.code,{children:"mhira-docker"})," folder"]}),"\n",(0,t.jsx)(n.p,{children:"cd mhira-docker"}),"\n",(0,t.jsxs)(n.p,{children:["Copy example ",(0,t.jsx)(n.code,{children:"environment"})," file to create your own config"]}),"\n",(0,t.jsx)(n.p,{children:"cp env-example .env"}),"\n",(0,t.jsx)(n.h3,{id:"setting-the-jwt-secret-in-the-env-file",children:"Setting the JWT Secret in the .env file"}),"\n",(0,t.jsxs)(n.p,{children:["Change the line ",(0,t.jsx)(n.code,{children:"JWT_SECRET=changeMe"})," after the equal sign to set the secret key, which is a 32 character string. Run this line in order to change it into a randomly generated key."]}),"\n",(0,t.jsx)(n.p,{children:'sed -i "s|changeMe|$(openssl rand -base64 32)|" .env'}),"\n",(0,t.jsx)(n.h3,{id:"data-storage-location",children:"Data Storage Location"}),"\n",(0,t.jsxs)(n.p,{children:["The location where mhira-docker installation will store data (i.e., the location of the mongodb and postgres databases) is controlled by the environment variable ",(0,t.jsx)(n.code,{children:"DATA_SAVE_PATH"})," in the .env file."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dotenv",children:"# Default location under current user home directory\nDATA_SAVE_PATH=~/.mhira-docker/data\n"})}),"\n",(0,t.jsx)(n.p,{children:"This is where all stateful containers (containers which persist data) will store their configuration and data."}),"\n",(0,t.jsx)(n.p,{children:"In a typical installation, the folder contents will be as listed below."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Data-Directory",src:i(2911).A+"",title:"Data Directory",width:"456",height:"100"})}),"\n",(0,t.jsx)(n.admonition,{title:"Important note on MHIRA running user context",type:"warning",children:(0,t.jsxs)(n.p,{children:["As the default data directory is a relative path to the current user's home directory, the user under which ",(0,t.jsx)(n.code,{children:"MHIRA"})," is running is of importance.\nFor example: 'docker compose' is run as root user, the data save path will be under the root user's home directory, i.e: ",(0,t.jsx)(n.code,{children:"/root/.mhira-docker/data"}),".\nSwitching a running instance of mhira to another user can result in apparent data loss, as the new user context will create a new data directory under their home directory, which will not include data from the old data directory.\nTo avoid this, you can replace the ",(0,t.jsx)(n.code,{children:"DATA_SAVE_PATH"})," with an absolute path pointing to a directory of your choice for persisting data."]})}),"\n",(0,t.jsx)(n.h3,{id:"settings-passwords-for-the-databases",children:"Settings passwords for the databases"}),"\n",(0,t.jsx)(n.p,{children:"For mongodb"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dockerfile",children:"### MONGODB ############################################################################################################\n\nMONGODB_PORT=27017\nMONGODB_CONNECTION_STRING=mongodb://mongo:27017/questionnaireDB\n"})}),"\n",(0,t.jsx)(n.p,{children:"For postgres (contains patient identifying information and user information)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dockerfile",children:"### POSTGRES ###########################################################################################################\n\nPOSTGRES_HOST=postgres\nPOSTGRES_DB=default\nPOSTGRES_USER=default\nPOSTGRES_PASSWORD=secret\nPOSTGRES_PORT=5432\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"caution",children:(0,t.jsx)(n.p,{children:"Not setting the database passwords can compromise the security of the application. Please use strong passwords."})}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsx)(n.p,{children:"Losing these database passwords means losing your data. Make sure to save them (in a secure and permanent location you have access to)."})}),"\n",(0,t.jsx)(n.h3,{id:"setting-access-of-mhira-and-https-certificates-in-the-env-file",children:"Setting access of MHIRA and HTTPS Certificates in the .env file"}),"\n",(0,t.jsxs)(n.p,{children:["To access MHIRA software from outside of the server, set ",(0,t.jsx)(n.code,{children:"SITE_DOMAIN"})," in your environment file to the externally accessible domain name or IP address of the server."]}),"\n",(0,t.jsx)(n.h1,{id:"site-domain-as-domain-name",children:"Site domain as domain name"}),"\n",(0,t.jsx)(n.p,{children:"SITE_DOMAIN=mhira.myorganization.com"}),"\n",(0,t.jsx)(n.h1,{id:"or-site-domain-as-servers-external-ip-address",children:"Or Site domain as server's external IP address"}),"\n",(0,t.jsx)(n.p,{children:"SITE_DOMAIN=192.168.10.2"}),"\n",(0,t.jsx)(n.h1,{id:"also-supports-multiple-domain-names-or-combination-of-ip-address-and-domains-with-comma-separation",children:"Also supports multiple domain names or combination of IP address and domains, with comma separation"}),"\n",(0,t.jsx)(n.p,{children:"SITE_DOMAIN=mhira.myorganization.com, 10.0.0.2"}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["If using a publicly accessible domain name as ",(0,t.jsx)(n.code,{children:"SITE_DOMAIN"}),", the bundled in ",(0,t.jsx)(n.a,{href:"https://caddyserver.com/",children:"Caddy"})," webserver will automatically provision a trusted HTTPS certificate for the domain."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["If using an internal domain name or IP address as ",(0,t.jsx)(n.code,{children:"SITE_DOMAIN"}),", the webserver will provision a self-signed certificate. Users will be faced with a security warning when accessing the site using self-signed certificate, and will need to accept/trust the certificate to access the site."]}),"\n"]}),"\n"]})}),"\n",(0,t.jsx)(n.h3,{id:"initialising-mhira",children:"Initialising MHIRA"}),"\n",(0,t.jsx)(n.p,{children:"After setting up the .env file, start docker compose to initialize MHIRA"}),"\n",(0,t.jsx)(n.p,{children:"docker compose pull\ndocker compose up --build -d"}),"\n",(0,t.jsxs)(n.p,{children:["If the above steps ran successfully, you should now be able to access the mhira application under the url(s) set as ",(0,t.jsx)(n.code,{children:"SITE_DOMAIN"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["e.g., ",(0,t.jsx)(n.a,{href:"https://localhost",children:"https://localhost"}),", ",(0,t.jsx)(n.a,{href:"https://mhira.myorganization.com",children:"https://mhira.myorganization.com"})," or ",(0,t.jsx)(n.a,{href:"https://192.168.10.2",children:"https://192.168.10.2"})]}),"\n",(0,t.jsxs)(n.admonition,{type:"note",children:[(0,t.jsx)(n.p,{children:"Later changes to the .env file come into effect by restarting the containers"}),(0,t.jsx)(n.p,{children:"docker compose stop\ndocker compose up -d"})]}),"\n",(0,t.jsx)(n.h2,{id:"updating-your-installation",children:"Updating your installation"}),"\n",(0,t.jsx)(n.p,{children:"To update your existing installation to a newer version of MHIRA software, execute following commands (you need to be in the folder with the docker compose .yml file)"}),"\n",(0,t.jsx)(n.h1,{id:"pull-latest-docker-config",children:"Pull latest docker config"}),"\n",(0,t.jsx)(n.p,{children:"git pull"}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsx)(n.p,{children:"The .env example file might have changed with the update, potentially leading to missing or superflous environment variables.\nIf a variable is missing, docker compose will output the corresponding error.\nPlease compare your old and the new environment variables for discrepancies.\nMake sure to take a copy of your old .env settings."})}),"\n",(0,t.jsx)(n.h1,{id:"pull-latest-docker-images",children:"Pull latest docker images"}),"\n",(0,t.jsx)(n.p,{children:"docker compose pull"}),"\n",(0,t.jsx)(n.h1,{id:"it-is-recommended-to-first-stop-the-containers",children:"It is recommended to first stop the containers"}),"\n",(0,t.jsx)(n.p,{children:"docker compose stop"}),"\n",(0,t.jsx)(n.h1,{id:"restart-containers-with-updated-images-and-config",children:"Restart containers with updated images and config"}),"\n",(0,t.jsx)(n.p,{children:"docker compose up -d --build --remove-orphan"}),"\n",(0,t.jsxs)(n.admonition,{type:"tip",children:[(0,t.jsx)(n.p,{children:"Old docker images and containers can take quite some space on your system. If this is a concern, you can prune unrequired elements."}),(0,t.jsx)(n.p,{children:"docker system prune -a"})]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},2911:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/data-directory-f7d3885e2d25c9a3683f020b0217dfa5.png"},8453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>a});var t=i(6540);const s={},o=t.createContext(s);function r(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);